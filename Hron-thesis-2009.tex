\documentclass[11pt,twoside,a4paper]{book}
\usepackage[english]{babel}
\usepackage[T1]{fontenc} 				% pouzije EC fonty
\usepackage[utf8]{inputenc} 			% utf8 kódování vstupu 
\usepackage[square, numbers]{natbib}	% sazba pouzite literatury
\usepackage{fancyhdr}					% tisk hlaviček a patiček stránek
% \usepackage{nomencl} 					% umožňuje snadno definovat zkratky a jejich seznam
\usepackage[acronym]{glossaries}

\usepackage{charter}					% font
\usepackage{pdfpages}					% inserting pdfs
% \usepackage[chapter]{easy-todo}
% \usepackage{todonotes}
\usepackage{pgfplots}
\usepackage{dirtytalk}
\usepackage{amsfonts}
\usepackage{subcaption}
\usepackage{algorithm}

\usepackage{listings}
\usepackage{xcolor}
\usepackage{pgf-pie}
\usepackage{xcolor}


\setlength\parindent{0pt}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% informace o práci
\newcommand\WorkTitle{Analyzing the execution of malware in a sandbox using hierarchical multiple instance learning}
\newcommand\FirstandFamilyName{Bc. Dominik Kouba}
\newcommand\Supervisor{doc. Ing. Tomáš Pevný, Ph.D.}
\newcommand\TypeOfWork{Master's Thesis}		
\newcommand\StudProgram{Open Informatics}
\newcommand\StudBranch{Cyber security}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% imports
\usepackage{graphicx}					% pro vkládání obrázků
\usepackage{k336_thesis_macros} 		% specialni makra pro formatovani DP a BP
\usepackage[
pdftitle={\WorkTitle},				% nastaví v informacích o pdf název
pdfauthor={\FirstandFamilyName},	% nastaví v informacích o pdf autora
colorlinks=true,					% před tiskem doporučujeme nastavit na false, aby odkazy a url nebyly šedé při ČB tisku
breaklinks=true,
urlcolor=red,
citecolor=blue,
linkcolor=blue,
unicode=true,
]
{hyperref}								% pro zobrazování "prokliknutelných" linků 

% rozšiřující importy
\usepackage{listings} 			%slouží pro tisk zdrojových kódů se syntax higlighting
\usepackage{algorithmicx} 		%slouží pro zápis algoritmů
\usepackage{algpseudocode} 		%slouží pro výpis pseudokódu
\usepackage{enumitem}
\usepackage{booktabs}

\newlist{abbrv}{itemize}{1}
\setlist[abbrv,1]{label=,labelwidth=1in,align=parleft,itemsep=0.1\baselineskip,leftmargin=!}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% příkazy šablony
\let\oldUrl\url				% url adresy budou zobrazeny: <url> 
\renewcommand\url[1]{<\texttt{\oldUrl{#1}}>}
\newtheorem{definition}{Definition}
\newcommand\todo[1]{\textcolor{red}{#1}}

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\definecolor{xblue}{rgb}{0.0, 0.0, 1.0}
\definecolor{xred}{rgb}{0.82, 0.1, 0.26}
\definecolor{xgreen}{rgb}{0.0, 0.5, 0.0}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

\lstdefinelanguage{mypython}{
  language     = Python,
  basicstyle=\normalfont\ttfamily,
  numbersep=8pt,
  showstringspaces=false,
  breaklines=true,
  frame=lines,
  backgroundcolor=\color{background},
  keywordstyle=\color{xblue},
  emph={MyClass,__init__},
  emphstyle=\color{xred},
  stringstyle=\color{xgreen},
  literate=
   *{0}{{{\color{numb}0}}}{1}
	{1}{{{\color{numb}1}}}{1}
	{2}{{{\color{numb}2}}}{1}
	{3}{{{\color{numb}3}}}{1}
	{4}{{{\color{numb}4}}}{1}
	{5}{{{\color{numb}5}}}{1}
	{6}{{{\color{numb}6}}}{1}
	{7}{{{\color{numb}7}}}{1}
	{8}{{{\color{numb}8}}}{1}
	{9}{{{\color{numb}9}}}{1}
	{:}{{{\color{punct}{:}}}}{1}
	{,}{{{\color{punct}{,}}}}{1}
	{\{}{{{\color{delim}{\{}}}}{1}
	{\}}{{{\color{delim}{\}}}}}{1}
	{[}{{{\color{delim}{[}}}}{1}
	{]}{{{\color{delim}{]}}}}{1},
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% vlastní dokument
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
	\selectlanguage{english}
	\translate

	% Assignment
	{
		\includepdf[pages=-]{pdfs/zadani.pdf}
		\newpage
	}

	% Title page 
	\coverpagestarts

	% Acknowledgements 
	\acknowledgements
	\noindent
	My deepest gratitude goes to my supervisor doc.~Ing.~Tomáš Pevný,~Ph.D. for giving me advice and helping me overcome struggles during this journey. I also sincerely thank to doc.~Mgr.~Branislav Bošanský,~Ph.D., Ing.~Thorsten Sick and Ing. Josef Liška for their advice and encouragement. Finally, I wish to extend my special thanks to my family.

	\noindent\rule{\textwidth}{0.4pt}

	\noindent Computational resources were supplied by the project "e-Infrastruktura CZ" (e-INFRA LM2018140) provided within the program Projects of Large Research, Development and Innovations Infrastructures. This support was very beneficial.


	% Declaration 
	\declaration{In Prague on May 15, 2021}

 	%Abstract 
	\abstractpage
	In this thesis we focus process of malware classification based on behavioral analysis - sandboxing. We design pipeline which collect malware samples from defined sources, train classifier, evaluate and perform prediction explanation. The main goal is to implement whole process report results and address problems which we indentify. As malware sample source we used https://bazaar.abuse.ch/ and for its analysis we used sandbox CAPEv2. We use distributed setup of the sandbox run which we implement and the dataset has $80000$ samples. From the sandbox log we extract json report and its behavior part we use to train binary classifiers. As labels we use the presence of specific signature which are also in beahvior log. We use \emph{hierarchival multiple instance learning} model which is designed to solve even tree-structured data input (like JSON documents) as we can see from the prior work. The model itself is built based on input data structure and the underlying model are artificial neural nets. Based on the type of signature the classifiers have different performance but majority of them shows results above 95\% AUC. We discuss result in the case of each particular signature. Finally we examine the predictions of the classifier using \emph{hmill explaniner} which is tool designed to use statistical method to derive subsample from original sample which has the strongest contribution to resulting prediction of classifier. The results show us that explanation sometime correlate with the original signature implementation and even with our intuition. On the other hand we do not take the confounding variable existence lightly and we discuss results with sufficient distance. Main issue here is big data entrophy which causes big variance in explanations which are performed per sample. So each sample could be explained in very different way than another despite using the same classifier. \
	
	\vspace{5mm}

	\noindent Keywords: \emph{Multilple instance learning, cybersecurity, malware}

	\let\cleardoublepage\clearpage

	\noindent
	\chapter*{Abstrakt}
	\noindent
	In this thesis we focus process of malware classification based on behavioral analysis - sandboxing. We design pipeline which collect malware samples from defined sources, train classifier, evaluate and perform prediction explanation. The main goal is to implement whole process report results and address problems which we indentify. As malware sample source we used https://bazaar.abuse.ch/ and for its analysis we used sandbox CAPEv2. We use distributed setup of the sandbox run which we implement and the dataset has $80000$ samples. From the sandbox log we extract json report and its behavior part we use to train binary classifiers. As labels we use the presence of specific signature which are also in beahvior log. We use \emph{hierarchival multiple instance learning} model which is designed to solve even tree-structured data input (like JSON documents) as we can see from the prior work. The model itself is built based on input data structure and the underlying model are artificial neural nets. Based on the type of signature the classifiers have different performance but majority of them shows results above 95\% AUC. We discuss result in the case of each particular signature. Finally we examine the predictions of the classifier using \emph{hmill explaniner} which is tool designed to use statistical method to derive subsample from original sample which has the strongest contribution to resulting prediction of classifier. The results show us that explanation sometime correlate with the original signature implementation and even with our intuition. On the other hand we do not take the confounding variable existence lightly and we discuss results with sufficient distance. Main issue here is big data entrophy which causes big variance in explanations which are performed per sample. So each sample could be explained in very different way than another despite using the same classifier.

	\vspace{5mm}

	\noindent Keywords: \emph{Multiinstanční hierarchické učení, kyberbezpečnost, malware}

	%%%%%%%%%%%%%%%%%%%%%%%%%%    
	% obsahy a seznamy
	\tableofcontents		% Obsah / Table of Contents 

	% pokud v práci nejsou obrázky nebo tabulky - odstraňte jejich seznam
	\listoffigures			% Obsah / Table of Contents 
	\listoftables			% Seznam tabulek / List of Tables

	%%%%%%%%%%%%%%%%%%%%%%%%%% 
	% TEXT
	\mainbodystarts

	%Chapters
	\part{Theory and prior}
	% \include{chapters/introduction.tex}
	% \include{chapters/analysis.tex}
	%\include{chapters/classification.tex}
	% \include{chapters/hmill.tex}
	% \include{chapters/explain_theory.tex}

	\part{Usecase and experiments}
	% \include{chapters/infrastructure.tex}
	%\include{chapters/data.tex}
	%\include{chapters/models.tex}
	% \include{chapters/explain_experiments.tex}
	%\include{chapters/conclusion.tex}
	
	%just to play with latex
	%\include{chapters/sandbox.tex}
	

	%%%%%%%%%%%%%%%%%%%%%%%%%% 
	% APPENDIX
	\appendix	

	% \printnomenclature
	% \label{apx:nomencl}
	\include{chapters/apendices/stack.tex}
	\include{chapters/apendices/models.tex}

	\include{chapters/acronyms.tex}

	%Biblio
	\bibliographystyle{alpha}
	%\bibliographystyle{csplainnat}
	%bibliographystyle{plain}
	% \bibliographystyle{psc}
	%\bibliographystyle{apalike}
	{
	\bibliography{bib/Master_thesis}
	}

	% \chapter{Obsah přiloženého CD}
	% \textbf{\large Tato příloha je povinná pro každou práci. Každá práce musí totiž obsahovat přiložené CD. Viz dále.}

	% Může vypadat například takto. Váš seznam samozřejmě bude odpovídat typu vaší práce. (viz \cite{infodp}):

	% \begin{figure}[h]
	% \begin{center}
	% \includegraphics[width=14cm]{figures/seznamcd}
	% \caption{Seznam přiloženého CD --- příklad}
	% \label{fig:seznamcd}
	% \end{center}
	% \end{figure}

	% Na GNU/Linuxu si strukturu přiloženého CD můžete snadno vyrobit příkazem:\\ 
	% \verb|$ tree . >tree.txt|\\
	% Ve vzniklém souboru pak stačí pouze doplnit komentáře.

	% Z \textbf{README.TXT} (případne index.html apod.)  musí být rovněž zřejmé, jak programy instalovat, spouštět a jaké požadavky mají tyto programy na hardware.

	% Adresář \textbf{text}  musí obsahovat soubor s vlastním textem práce v PDF nebo PS formátu, který bude později použit pro prezentaci diplomové práce na WWW.

\end{document}
